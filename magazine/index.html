<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>My Magazine</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<meta name="theme-color" content="#ff3366">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta content="telephone=no" name="format-detection">
	<link rel="icon" type="image/jpg" href="images/Icon-60@2x.png">
    <link rel="apple-touch-startup-image" href="images/start-up.png">
    <link rel="apple-touch-icon" sizes="29x29" href="images/Icon-Small.png">
    <link rel="apple-touch-icon" sizes="57x57" href="images/Icon.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/Icon@2x.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/Icon-60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/Icon-60@2x.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/Icon-60@3x.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/Icon-72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/Icon-72@2x.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/Icon-76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/Icon-76@2x.png">
    <link rel="apple-touch-icon" sizes="1024x1024" href="images/iTunesArtwork@2x.png">
    <link rel="icon" type="image/png" sizes="64x64" href="images/Icon-60.png">
    <link rel="icon" type="image/png" sizes="1024x1024" href="images/iTunesArtwork@2x.png">
	<link rel="stylesheet" href="style/style.css">
    <preference name="DisallowOverscroll" value="true" />
    <link rel="manifest" href="manifest.json">
	<script src="js/jquery-2.1.3.min.js"></script>
	<script src="js/jquery.mobile.custom.min.js"></script>
</head>

<body>
	<div id="desk" class="blur invisible">
		<div id="desk-background"></div>
		<div id="area">

			<div id="main">

				<div id="misc">
					<div id="misc_coffee"><img src="http://jizhi-10061919.file.myqcloud.com/temp/coffee.svg"></div>
				</div>

				<div id="magazine_main open">
					<div id="magazine_pages">
						
						<div class="magazine_page_container page_right shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
							</div>
						</div>
                      
						<div class="magazine_page_container page_left shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout07 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/31.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/32.jpg">
										<label>图片2</label>
									</div>
								</div>
							</div>
						</div>
                      
						<div class="magazine_page_container page_right shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout08 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/26.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/27.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/28.jpg">
										<label>图片3</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/29.jpg">
										<label>图片4</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/30.jpg">
										<label>图片5</label>
									</div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_left shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout04 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/21.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/22.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/23.jpg">
										<label>图片3</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/24.jpg">
										<label>图片4</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/25.jpg">
										<label>图片5</label>
									</div>
								</div>
							</div>
						</div>
						
						<div class="magazine_page_container page_right shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout01 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/18.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/19.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/20.jpg">
										<label>图片3</label>
									</div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_left shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout05 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/14.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/15.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/16.jpg">
										<label>图片3</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/17.jpg">
										<label>图片4</label>
									</div>
								</div>
							</div>
						</div>
						
						<div class="magazine_page_container page_right shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout05 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/10.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/11.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/12.jpg">
										<label>图片3</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/13.jpg">
										<label>图片4</label>
									</div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_left shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout06 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/06.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/07.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/08.jpg">
										<label>图片3</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/09.jpg">
										<label>图片4</label>
									</div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_right shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout01 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/03.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/04.jpg">
										<label>图片2</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/05.jpg">
										<label>图片3</label>
									</div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_left shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_images layout07 magazine_content">
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/01.jpg">
										<label>图片1</label>
									</div>
									<div class="magazine_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/02.jpg">
										<label>图片2</label>
                                    </div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_right shadow" id="magazine_first_container">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_content">
									<div class="magazine_avatar"><img src="http://jizhi-10061919.file.myqcloud.com/temp/zequn.jpg"></div>
									<div class="magazine_quote">Hello!<br>I'm Alice!</div>
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_left shadow">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_content">
								</div>
							</div>
						</div>

						<div class="magazine_page_container page_right active" id="magazine_cover_container">
							<div class="magazine_page">
								<div class="magazine_shadow"></div>
								<div class="magazine_image magazine_cover_image"><img src="http://jizhi-10061919.file.myqcloud.com/temp/04.jpg"></div>
								<div class="magazine_content magazine_cover_content">
									<div class="magazine_cover_title">
										Alice's
										<br>Masterpiece Album
									</div>
								</div>
							</div>
						</div>
					</div>
					<div id="left_arrow"></div>
					<div id="right_arrow"></div>
				</div>

			</div>

		</div>
	</div>

	<div id="loading_panel">
		<div id="loading_sticker">
			<div id="loading_front">
				<div id="loading_title">
					<div>Loading...</div>
				</div>
				<div id="loading_text">My Magazine</div>
			</div>
		</div>
	</div>
	
	<script>
		$(".magazine_image").on("click", function () {
			if ($(this).hasClass("expand")) {
				var node = $(this);
				node.addClass("expand").removeClass("expand");
				$('.page_right.active').removeClass('shadow');
				$('.page_left.active').removeClass('shadow');
				setTimeout(function () {
					node.css('z-index', '1');
					node.parents('.magazine_page_container').css('z-index', '');
					expand = false;
				}, 1000);
			} else {
				expand = true;
				$(".magazine_image.expand").removeClass("expand");
				$('.page_right.active').addClass('shadow');
				$('.page_left.active').addClass('shadow');
				$(this).addClass("expand");
				$(this).css('z-index', '100000');
				$(this).parents('.magazine_page_container').css('z-index', '1001');
			}
		});
		var flipping = false;
		var expand = false;
		var page_count = 6;
		var page_index = 0;

		function goNext() {
			if (flipping || expand) {
				return;
			} else if (page_index === 0) {
				flipping = true;
				$("#desk").addClass("open");
				setTimeout(function () {
					var indexL = 2 * page_count + 1;
					var indexR = $('.page_right.active').index();
					$('.page_right.active').addClass('flipped');
					$('.page_right.active').addClass('shadow');
					$('.magazine_page_container').eq(indexR - 2).removeClass('shadow');
					$('.magazine_page_container').eq(indexL - 2).removeClass('shadow');
					$('.magazine_page_container').eq(indexL - 2).addClass('flipped').addClass('active');
					$('.magazine_page_container').eq(indexR - 2).addClass('acting');
					setTimeout(function () {
						$('.magazine_page_container').eq(indexR).removeClass('active');
					}, 1000);
					setTimeout(function () {
						$('.magazine_page_container').eq(indexR - 2).removeClass('acting').addClass('active');
						flipping = false;
						page_index += 1;
					}, 2000);
				}, 1000);
			} else if (page_index < page_count) {
				flipping = true;
				var indexL = $('.page_left.active').index();
				var indexR = $('.page_right.active').index();
				$('.page_left.active').removeClass('active').addClass('acting');
				$('.page_right.active').addClass('flipped');
				$('.page_right.active').addClass('shadow');
				$('.page_left.active').addClass('shadow');
				$('.magazine_page_container').eq(indexR - 2).removeClass('shadow');
				$('.magazine_page_container').eq(indexL - 2).removeClass('shadow');
				$('.magazine_page_container').eq(indexL - 2).addClass('flipped').addClass('active');
				$('.magazine_page_container').eq(indexR - 2).addClass('acting');
				setTimeout(function () {
					$('.magazine_page_container').eq(indexR).removeClass('active');
				}, 1000);
				setTimeout(function () {
					$('.magazine_page_container').eq(indexL).removeClass('acting');
					$('.magazine_page_container').eq(indexR - 2).removeClass('acting').addClass('active');
					flipping = false;
					page_index += 1;
				}, 2000);
			}
		}
		function goFullScreen() {
            var el = document.documentElement,
                rfs = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen;
            rfs.call(el);
        }
		function goPrevious() {
			if (flipping || expand) {
				return;
			} else if (page_index === 1) {
				flipping = true;
				var indexL = $('.page_left.active').index();
				var indexR = $('.page_right.active').index();
				$('.page_right.active').removeClass('active').addClass('acting');
				$('.page_left.active').removeClass('flipped');
				$('.page_right.active').addClass('shadow');
				$('.page_left.active').addClass('shadow');
				$('.magazine_page_container').eq(indexR + 2).removeClass('shadow');
				$('.magazine_page_container').eq(indexR + 2).removeClass('flipped').addClass('active');
				setTimeout(function () {
					$('.magazine_page_container').eq(indexL).removeClass('active');
				}, 1000);
				setTimeout(function () {
					$('.magazine_page_container').eq(indexR).removeClass('acting');
					flipping = false;
					page_index -= 1;
					$("#desk").removeClass("open");
				}, 2000);
			} else if (page_index > 0) {
				flipping = true;
				var indexL = $('.page_left.active').index();
				var indexR = $('.page_right.active').index();
				$('.page_right.active').removeClass('active').addClass('acting');
				$('.page_left.active').removeClass('flipped');
				$('.page_right.active').addClass('shadow');
				$('.page_left.active').addClass('shadow');
				$('.magazine_page_container').eq(indexR + 2).removeClass('shadow');
				$('.magazine_page_container').eq(indexL + 2).removeClass('shadow');
				$('.magazine_page_container').eq(indexR + 2).removeClass('flipped').addClass('active');
				$('.magazine_page_container').eq(indexL + 2).addClass('acting');
				setTimeout(function () {
					$('.magazine_page_container').eq(indexL).removeClass('active');
				}, 1000);
				setTimeout(function () {
					$('.magazine_page_container').eq(indexR).removeClass('acting');
					$('.magazine_page_container').eq(indexL + 2).removeClass('acting').addClass('active');
					flipping = false;
					page_index -= 1;
				}, 2000);
			}
		}
		$(document).keydown(function (e) {
			if (e.keyCode == 37) {
				goPrevious();
			} else if (e.keyCode == 39) {
				goNext();
			}
		});
        document.getElementById("desk-background").addEventListener('touchmove', function(e) {
          e.preventDefault();
        }, false);
		$("#magazine_cover_container .magazine_page").click(function(){
			goNext();
		});
		$(document).on("swipeleft",function(){
			goNext();
		});
		$(document).on("swiperight",function(){
			goPrevious();
		});
		$("#misc_coffee").click(function(){
			goFullScreen();
		});
		$("#left_arrow").click(function(){
			goPrevious();
		});
		$("#right_arrow").click(function(){
			goNext();
		});
		$("#loading_sticker").addClass("show");
		$(document).ready(function(){
			$("#desk").removeClass("invisible");
		});
		$(window).on("load", function() {
			$("#loading_sticker").removeClass("show");
			$("#desk").removeClass("blur");
			setTimeout(function(){
				$("#loading_panel").remove();
			},1000);
		});
	</script>
</body>

</html>